# FunASRéŸ³é¢‘è½¬æ–‡æœ¬æœåŠ¡å™¨å…¼å®¹æ€§å¼€å‘æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸ºæ‚¨åˆ†æäº†ç°æœ‰FunASRéŸ³é¢‘è½¬æ–‡æœ¬æœåŠ¡å™¨é¡¹ç›®çš„å®Œæ•´æŠ€æœ¯æ¶æ„å’Œå®ç°ç»†èŠ‚ï¼Œä»¥ä¾¿æ‚¨å¼€å‘å®Œå…¨å…¼å®¹çš„æ–°æœåŠ¡å™¨ã€‚è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºFunASRçš„éŸ³è§†é¢‘è½¬å½•æœåŠ¡å™¨ï¼Œæ”¯æŒè¯´è¯äººè¯†åˆ«ã€æ—¶é—´æˆ³æ ‡æ³¨ï¼Œæä¾›JSONå’ŒSRTä¸¤ç§è¾“å‡ºæ ¼å¼ã€‚

## 1. ç³»ç»Ÿæ¶æ„

### 1.1 æ ¸å¿ƒæ¶æ„æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket     â”‚â”€â”€â”€â–¶â”‚  Task Manager   â”‚â”€â”€â”€â–¶â”‚ FunASR Engine   â”‚
â”‚   Handler       â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  (æ¥æ”¶è¯·æ±‚)      â”‚    â”‚  (é˜Ÿåˆ—ç®¡ç†)      â”‚    â”‚  (AIè½¬å½•)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Auth &        â”‚    â”‚   Database      â”‚    â”‚  File Manager   â”‚
â”‚   Validation    â”‚    â”‚   (ç¼“å­˜&åŸå§‹)    â”‚    â”‚  (ä¸Šä¼ &æ¸…ç†)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒç»„ä»¶

1. **ä¸»æœåŠ¡å™¨** (`src/main.py`)ï¼šç®¡ç†æ•´ä½“æœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸ
2. **WebSocketå¤„ç†å™¨** (`src/api/websocket_handler.py`)ï¼šå¤„ç†å®¢æˆ·ç«¯è¿æ¥å’Œæ¶ˆæ¯è·¯ç”±
3. **ä»»åŠ¡ç®¡ç†å™¨** (`src/core/task_manager.py`)ï¼šå¹¶å‘ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
4. **FunASRè½¬å½•å™¨** (`src/core/funasr_transcriber.py`)ï¼šAIè½¬å½•å¼•æ“
5. **æ•°æ®åº“ç®¡ç†å™¨** (`src/core/database.py`)ï¼šè½¬å½•ç»“æœç¼“å­˜
6. **æ–‡ä»¶ç®¡ç†å™¨** (`src/utils/file_utils.py`)ï¼šæ–‡ä»¶ä¸Šä¼ å’ŒéªŒè¯

## 2. é€šä¿¡åè®®è§„èŒƒ

### 2.1 WebSocketåè®®

**æœåŠ¡å™¨åœ°å€**: `ws://host:port` (é»˜è®¤: `ws://localhost:8767`)

**è¿æ¥é…ç½®**:
```javascript
{
  max_size: 5000 * 1024 * 1024,  // æœ€å¤§æ¶ˆæ¯5GB
  max_queue: 100,                 // æœ€å¤§è¿æ¥æ•°
  ping_interval: 60,              // å¿ƒè·³é—´éš”60ç§’
  ping_timeout: 120,              // å¿ƒè·³è¶…æ—¶120ç§’
  read_limit: 1MB,                // è¯»ç¼“å†²åŒº
  write_limit: 1MB,               // å†™ç¼“å†²åŒº
  compression: null               // ç¦ç”¨å‹ç¼©
}
```

### 2.2 æ¶ˆæ¯æ ¼å¼

**åŸºç¡€æ¶ˆæ¯ç»“æ„**:
```json
{
  "type": "æ¶ˆæ¯ç±»å‹",
  "data": {
    // æ¶ˆæ¯æ•°æ®
  },
  "timestamp": "ISOæ—¶é—´æˆ³"
}
```

### 2.3 æ¶ˆæ¯ç±»å‹è¯¦è§£

#### 2.3.1 è¿æ¥é˜¶æ®µ

**æœåŠ¡å™¨æ¬¢è¿æ¶ˆæ¯**:
```json
{
  "type": "connected",
  "data": {
    "connection_id": "è¿æ¥ID",
    "message": "è¿æ¥æˆåŠŸ",
    "server_time": "2024-01-01T12:00:00Z"
  }
}
```

**å®¢æˆ·ç«¯å¿ƒè·³**:
```json
{
  "type": "ping",
  "data": {}
}
```

**æœåŠ¡å™¨å¿ƒè·³å“åº”**:
```json
{
  "type": "pong",
  "data": {
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

#### 2.3.2 è®¤è¯é˜¶æ®µ (å¯é€‰)

**è®¤è¯è¦æ±‚é€šçŸ¥**:
```json
{
  "type": "auth_required",
  "data": {
    "message": "è¯·æä¾›è®¤è¯ä»¤ç‰Œ"
  }
}
```

**å®¢æˆ·ç«¯è®¤è¯**:
```json
{
  "type": "auth",
  "data": {
    "token": "JWT-TOKEN"
  }
}
```

**è®¤è¯æˆåŠŸ**:
```json
{
  "type": "auth_success",
  "data": {
    "message": "è®¤è¯æˆåŠŸ",
    "user": {
      "username": "ç”¨æˆ·å"
    }
  }
}
```

#### 2.3.3 æ–‡ä»¶ä¸Šä¼ é˜¶æ®µ

**ä¸Šä¼ è¯·æ±‚** (æ”¯æŒå•æ–‡ä»¶å’Œåˆ†ç‰‡ä¸¤ç§æ¨¡å¼):
```json
{
  "type": "upload_request",
  "data": {
    "file_name": "test.mp3",
    "file_size": 1024000,
    "file_hash": "md5-hash",
    "force_refresh": false,
    "output_format": "json",  // "json" æˆ– "srt"
    "upload_mode": "single"   // "single" æˆ– "chunked"
  }
}
```

**åˆ†ç‰‡ä¸Šä¼ è¯·æ±‚**:
```json
{
  "type": "upload_request",
  "data": {
    "file_name": "large_file.mp3",
    "file_size": 50000000,
    "file_hash": "md5-hash",
    "upload_mode": "chunked",
    "chunk_size": 1048576,    // 1MBåˆ†ç‰‡
    "total_chunks": 48,
    "output_format": "json"
  }
}
```

**ä¸Šä¼ å°±ç»ªå“åº”**:
```json
{
  "type": "upload_ready",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "message": "å‡†å¤‡æ¥æ”¶æ–‡ä»¶æ•°æ®"
  }
}
```

#### 2.3.4 æ–‡ä»¶æ•°æ®ä¼ è¾“

**å•æ–‡ä»¶ä¸Šä¼ æ•°æ®**:
```json
{
  "type": "upload_data",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "file_data": "base64ç¼–ç çš„æ–‡ä»¶æ•°æ®"
  }
}
```

**åˆ†ç‰‡æ•°æ®ä¸Šä¼ **:
```json
{
  "type": "upload_chunk",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "chunk_index": 0,
    "chunk_data": "base64ç¼–ç çš„åˆ†ç‰‡æ•°æ®",
    "chunk_hash": "åˆ†ç‰‡MD5å“ˆå¸Œ"
  }
}
```

**åˆ†ç‰‡æ¥æ”¶ç¡®è®¤**:
```json
{
  "type": "chunk_received",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "chunk_index": 0,
    "progress": 10.5,
    "status": "received"
  }
}
```

**ä¸Šä¼ å®Œæˆç¡®è®¤**:
```json
{
  "type": "upload_complete",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œå¼€å§‹å¤„ç†"
  }
}
```

#### 2.3.5 ä»»åŠ¡å¤„ç†é˜¶æ®µ

**æ’é˜Ÿé€šçŸ¥** (é˜Ÿåˆ—æ»¡æ—¶):
```json
{
  "type": "task_queued",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "queue_position": 3,
    "estimated_wait_minutes": 6,
    "message": "ä»»åŠ¡æ’é˜Ÿä¸­"
  }
}
```

**å¤„ç†è¿›åº¦**:
```json
{
  "type": "task_progress",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "progress": 45.5,
    "status": "processing",
    "message": "è½¬å½•è¿›åº¦: 45.5%",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

#### 2.3.6 ç»“æœè¿”å›é˜¶æ®µ

**JSONæ ¼å¼å®Œæˆ**:
```json
{
  "type": "task_complete",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "result": {
      "task_id": "ä»»åŠ¡ID",
      "file_name": "test.mp3",
      "file_hash": "md5-hash",
      "duration": 120.5,
      "segments": [
        {
          "start_time": 0.88,
          "end_time": 5.195,
          "text": "æ¬¢è¿å¤§å®¶æ¥ä½“éªŒè¾¾æ‘©é™¢æ¨å‡ºçš„è¯­éŸ³è¯†åˆ«æ¨¡å‹ã€‚",
          "speaker": "Speaker1"
        }
      ],
      "speakers": ["Speaker1"],
      "created_at": "2024-01-01T12:00:00Z",
      "processing_time": 1.03,
      "error": null
    },
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

**SRTæ ¼å¼å®Œæˆ**:
```json
{
  "type": "task_complete",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "result": {
      "format": "srt",
      "content": "1\\n00:00:00,880 --> 00:00:05,195\\nSpeaker1:æ¬¢è¿å¤§å®¶...",
      "file_name": "test.mp3",
      "file_hash": "md5-hash"
    },
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

#### 2.3.7 é”™è¯¯å¤„ç†

**é”™è¯¯å“åº”**:
```json
{
  "type": "error",
  "data": {
    "error": "é”™è¯¯ç±»å‹",
    "message": "é”™è¯¯æè¿°",
    "details": {
      // å¯é€‰çš„è¯¦ç»†ä¿¡æ¯
    }
  }
}
```

**å¸¸è§é”™è¯¯ç±»å‹**:
- `auth_failed`: è®¤è¯å¤±è´¥
- `invalid_json`: æ— æ•ˆJSONæ ¼å¼
- `invalid_file_type`: ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹
- `file_too_large`: æ–‡ä»¶è¿‡å¤§
- `hash_mismatch`: æ–‡ä»¶å“ˆå¸Œä¸åŒ¹é…
- `upload_error`: ä¸Šä¼ é”™è¯¯
- `task_not_found`: ä»»åŠ¡ä¸å­˜åœ¨
- `queue_full`: ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡

#### 2.3.8 ä»»åŠ¡æ§åˆ¶

**æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€**:
```json
{
  "type": "task_status",
  "data": {
    "task_id": "ä»»åŠ¡ID"
  }
}
```

**å–æ¶ˆä»»åŠ¡**:
```json
{
  "type": "cancel_task",
  "data": {
    "task_id": "ä»»åŠ¡ID"
  }
}
```

**ä»»åŠ¡å–æ¶ˆç¡®è®¤**:
```json
{
  "type": "task_cancelled",
  "data": {
    "task_id": "ä»»åŠ¡ID",
    "message": "ä»»åŠ¡å·²å–æ¶ˆ"
  }
}
```

## 3. æ•°æ®æ¨¡å‹è§„èŒƒ

### 3.1 ä»»åŠ¡çŠ¶æ€æšä¸¾
```python
class TaskStatus(str, Enum):
    PENDING = "pending"        # ç­‰å¾…ä¸­
    PROCESSING = "processing"  # å¤„ç†ä¸­
    COMPLETED = "completed"    # å·²å®Œæˆ
    FAILED = "failed"         # å¤±è´¥
    CANCELLED = "cancelled"   # å·²å–æ¶ˆ
```

### 3.2 è½¬å½•ç‰‡æ®µæ¨¡å‹
```python
{
  "start_time": float,    # å¼€å§‹æ—¶é—´(ç§’)
  "end_time": float,      # ç»“æŸæ—¶é—´(ç§’)
  "text": str,            # è½¬å½•æ–‡æœ¬
  "speaker": str          # è¯´è¯äººæ ‡è¯†
}
```

### 3.3 è½¬å½•ç»“æœæ¨¡å‹
```python
{
  "task_id": str,                    # ä»»åŠ¡ID
  "file_name": str,                  # æ–‡ä»¶å
  "file_hash": str,                  # æ–‡ä»¶å“ˆå¸Œ
  "duration": float,                 # éŸ³é¢‘æ—¶é•¿(ç§’)
  "segments": [TranscriptionSegment], # è½¬å½•ç‰‡æ®µåˆ—è¡¨
  "speakers": [str],                 # è¯´è¯äººåˆ—è¡¨
  "created_at": str,                 # åˆ›å»ºæ—¶é—´(ISO)
  "processing_time": float,          # å¤„ç†æ—¶é•¿(ç§’)
  "error": str | null                # é”™è¯¯ä¿¡æ¯
}
```

## 4. é…ç½®è§„èŒƒ

### 4.1 æœåŠ¡å™¨é…ç½®
```json
{
  "server": {
    "host": "0.0.0.0",
    "port": 8767,
    "max_connections": 100,
    "max_file_size_mb": 5000,
    "allowed_extensions": [".wav", ".mp3", ".mp4", ".m4a", ".flac", ".aac", ".ogg", ".opus"],
    "temp_dir": "./temp",
    "upload_dir": "./uploads"
  }
}
```

### 4.2 è½¬å½•é…ç½®
```json
{
  "transcription": {
    "max_concurrent_tasks": 3,
    "concurrency_mode": "pool",
    "task_timeout_minutes": 30,
    "retry_times": 2,
    "cache_enabled": true,
    "delete_after_transcription": true,
    "transcription_speed_ratio": 10,
    "max_queue_size": 100,
    "queue_status_enabled": true
  }
}
```

### 4.3 è®¤è¯é…ç½®
```json
{
  "auth": {
    "enabled": false,
    "secret_key": "your-secret-key",
    "algorithm": "HS256",
    "access_token_expire_minutes": 1440
  }
}
```

## 5. æ ¸å¿ƒåŠŸèƒ½å®ç°è¦æ±‚

### 5.1 æ–‡ä»¶ä¸Šä¼ æœºåˆ¶

#### å•æ–‡ä»¶ä¸Šä¼  (<5MB)
1. å®¢æˆ·ç«¯å‘é€`upload_request`
2. æœåŠ¡å™¨æ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœ‰ç¼“å­˜ç›´æ¥è¿”å›ç»“æœ
3. æœåŠ¡å™¨è¿”å›`upload_ready`
4. å®¢æˆ·ç«¯å‘é€`upload_data`(Base64ç¼–ç )
5. æœåŠ¡å™¨éªŒè¯æ–‡ä»¶å¤§å°å’Œå“ˆå¸Œ
6. æœåŠ¡å™¨è¿”å›`upload_complete`

#### åˆ†ç‰‡ä¸Šä¼  (â‰¥5MB)
1. å®¢æˆ·ç«¯å‘é€åˆ†ç‰‡`upload_request` (`upload_mode: "chunked"`)
2. æœåŠ¡å™¨åˆ›å»ºä¸Šä¼ ä¼šè¯ï¼Œè¿”å›`upload_ready`
3. å®¢æˆ·ç«¯å‘é€å¤šä¸ª`upload_chunk`æ¶ˆæ¯
4. æœåŠ¡å™¨ç¡®è®¤æ¯ä¸ªåˆ†ç‰‡ï¼š`chunk_received`
5. æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®ŒæˆåéªŒè¯å®Œæ•´æ€§
6. æœåŠ¡å™¨è¿”å›`upload_complete`

#### å…³é”®ç‰¹æ€§
- **æ–‡ä»¶å“ˆå¸ŒéªŒè¯**: MD5å“ˆå¸ŒéªŒè¯æ–‡ä»¶å®Œæ•´æ€§
- **åˆ†ç‰‡å»é‡**: æ”¯æŒåˆ†ç‰‡é‡ä¼ ï¼Œé¿å…é‡å¤ä¸Šä¼ 
- **ç¼“å­˜æœºåˆ¶**: åŸºäºæ–‡ä»¶å“ˆå¸Œçš„æ™ºèƒ½ç¼“å­˜
- **æ ¼å¼è½¬æ¢**: åŒä¸€æ–‡ä»¶æ”¯æŒJSON/SRTæ ¼å¼åˆ‡æ¢

### 5.2 å¹¶å‘å¤„ç†æœºåˆ¶

#### ä»»åŠ¡é˜Ÿåˆ—è®¾è®¡
```python
class TaskManager:
    def __init__(self):
        self.task_queue = asyncio.Queue(maxsize=max_queue_size)
        self.processing_tasks = 0
        self.max_concurrent_tasks = 3  # å¯é…ç½®
```

#### æ’é˜ŸçŠ¶æ€é€šçŸ¥
- å½“å¹¶å‘æ•°è¶…è¿‡é™åˆ¶æ—¶ï¼Œæ–°ä»»åŠ¡è¿›å…¥æ’é˜Ÿ
- å®æ—¶è®¡ç®—æ’é˜Ÿä½ç½®å’Œé¢„ä¼°ç­‰å¾…æ—¶é—´
- å‘é€`task_queued`æ¶ˆæ¯é€šçŸ¥å®¢æˆ·ç«¯

#### ä»»åŠ¡è°ƒåº¦ç­–ç•¥
- FIFOé˜Ÿåˆ—å¤„ç†
- åŠ¨æ€è¶…æ—¶ç®—æ³•é¿å…ä»»åŠ¡å¡ä½
- æ™ºèƒ½é‡è¯•æœºåˆ¶å¤„ç†ä¸´æ—¶é”™è¯¯
- èµ„æºæ¸…ç†ä¿è¯ç³»ç»Ÿç¨³å®šæ€§

### 5.3 ç¼“å­˜ç³»ç»Ÿ

#### SQLiteæ•°æ®åº“è®¾è®¡
```sql
CREATE TABLE transcription_cache (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    file_hash TEXT UNIQUE NOT NULL,
    file_name TEXT NOT NULL,
    result TEXT NOT NULL,          -- JSONæ ¼å¼ç»“æœ
    raw_result TEXT,               -- åŸå§‹FunASRç»“æœ
    duration REAL,
    processing_time REAL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### ç¼“å­˜ç­–ç•¥
- **æ™ºèƒ½ç¼“å­˜**: åŸºäºMD5å“ˆå¸Œè‡ªåŠ¨ç¼“å­˜
- **æ ¼å¼çµæ´»**: æ”¯æŒJSON/SRTæ ¼å¼äº’è½¬
- **è¿‡æœŸæ¸…ç†**: å®šæœŸæ¸…ç†è¶…è¿‡30å¤©çš„ç¼“å­˜
- **è®¿é—®æ›´æ–°**: æ›´æ–°æœ€åè®¿é—®æ—¶é—´

### 5.4 é”™è¯¯å¤„ç†æœºåˆ¶

#### é”™è¯¯åˆ†ç±»
```python
# ä¸å¯é‡è¯•é”™è¯¯
non_retryable_errors = [
    "éŸ³é¢‘æ—¶é•¿è¿‡çŸ­",
    "æ–‡ä»¶ä¸å­˜åœ¨",
    "ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼",
    "æ–‡ä»¶å¤ªå¤§",
    "è®¤è¯å¤±è´¥"
]

# æ¨¡å‹ç›¸å…³é”™è¯¯(å¯é‡è¯•)
model_errors = [
    "VAD algorithm",
    "index .* out of bounds",
    "list index out of range"
]
```

#### é‡è¯•æœºåˆ¶
- æ™ºèƒ½é‡è¯•: æ ¹æ®é”™è¯¯ç±»å‹å†³å®šæ˜¯å¦é‡è¯•
- é‡è¯•æ¬¡æ•°é™åˆ¶: æœ€å¤šé‡è¯•2æ¬¡
- æ¨¡å‹é‡ç½®: é‡åˆ°æ¨¡å‹é”™è¯¯æ—¶é‡ç½®æ¨¡å‹çŠ¶æ€
- è¯¦ç»†é”™è¯¯åˆ†ç±»: ä¸ºå®¢æˆ·ç«¯æä¾›ç²¾ç¡®é”™è¯¯ç±»å‹

## 6. æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

### 6.1 å†…å­˜ç®¡ç†
- åˆ†ç‰‡ä¸Šä¼ å‡å°‘å†…å­˜å ç”¨
- åŠæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- æµå¼å¤„ç†é¿å…å¤§æ–‡ä»¶å†…å­˜æº¢å‡º

### 6.2 å¹¶å‘ä¼˜åŒ–
- å¼‚æ­¥I/Oå¤„ç†
- è¿æ¥æ± ç®¡ç†
- ä»»åŠ¡é˜Ÿåˆ—é™åˆ¶é˜²æ­¢è¿‡è½½

### 6.3 ç½‘ç»œä¼˜åŒ–
- ç¦ç”¨WebSocketå‹ç¼©å‡å°‘CPUè´Ÿè½½
- å¢åŠ ç¼“å†²åŒºå¤§å°æ”¯æŒå¤§æ–‡ä»¶ä¼ è¾“
- å¿ƒè·³æœºåˆ¶ä¿æŒé•¿è¿æ¥ç¨³å®š

## 7. ç³»ç»Ÿç›‘æ§ä¸é€šçŸ¥

### 7.1 ä¼ä¸šå¾®ä¿¡é€šçŸ¥
```python
# ä»»åŠ¡å®Œæˆ/å¤±è´¥é€šçŸ¥
await send_wework_notification(task, "completed")
await send_wework_notification(task, "failed")

# æœåŠ¡å™¨å¯åŠ¨/åœæ­¢é€šçŸ¥
await send_custom_notification("ğŸš€ æœåŠ¡å™¨å·²å¯åŠ¨", details)
await send_custom_notification("ğŸ›‘ æœåŠ¡å™¨å·²åœæ­¢", details)
```

### 7.2 ç³»ç»Ÿç»Ÿè®¡
```python
# ä»»åŠ¡ç»Ÿè®¡
{
    "total_tasks": int,
    "pending_tasks": int,
    "processing_tasks": int,
    "completed_tasks": int,
    "failed_tasks": int,
    "queue_size": int
}

# ç¼“å­˜ç»Ÿè®¡
{
    "total_count": int,
    "today_count": int,
    "cache_size_mb": float
}
```

## 8. å…¼å®¹æ€§æ£€æŸ¥æ¸…å•

### 8.1 åè®®å…¼å®¹æ€§
- [ ] WebSocketè¿æ¥å‚æ•°ä¸€è‡´
- [ ] æ¶ˆæ¯æ ¼å¼å®Œå…¨åŒ¹é…
- [ ] é”™è¯¯ä»£ç å¯¹åº”æ­£ç¡®
- [ ] è®¤è¯æµç¨‹å…¼å®¹

### 8.2 åŠŸèƒ½å…¼å®¹æ€§
- [ ] æ”¯æŒå•æ–‡ä»¶å’Œåˆ†ç‰‡ä¸Šä¼ 
- [ ] JSON/SRTæ ¼å¼è¾“å‡º
- [ ] è¯´è¯äººè¯†åˆ«å’Œåˆå¹¶
- [ ] ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸
- [ ] æ’é˜ŸçŠ¶æ€é€šçŸ¥

### 8.3 æ€§èƒ½å…¼å®¹æ€§
- [ ] å¹¶å‘å¤„ç†èƒ½åŠ›
- [ ] æ–‡ä»¶å¤§å°é™åˆ¶
- [ ] å“åº”æ—¶é—´è¦æ±‚
- [ ] å†…å­˜ä½¿ç”¨æ§åˆ¶

### 8.4 APIå…¼å®¹æ€§
- [ ] æ‰€æœ‰æ¶ˆæ¯ç±»å‹æ”¯æŒ
- [ ] æ•°æ®æ¨¡å‹ç»“æ„ä¸€è‡´
- [ ] æ—¶é—´æˆ³æ ¼å¼ç»Ÿä¸€
- [ ] ç¼–ç æ ¼å¼æ­£ç¡®

## 9. å¼€å‘å»ºè®®

### 9.1 æŠ€æœ¯æ ˆé€‰æ‹©
- **å¼‚æ­¥æ¡†æ¶**: æ¨èä½¿ç”¨asyncio/uvloop
- **WebSocketåº“**: websocketsæˆ–ç±»ä¼¼åº“
- **æ•°æ®åº“**: SQLiteç”¨äºç¼“å­˜(å¯æ‰©å±•åˆ°PostgreSQL)
- **æ¶ˆæ¯åºåˆ—åŒ–**: JSON
- **æ–‡ä»¶å¤„ç†**: æ”¯æŒFFmpegéŸ³é¢‘è½¬æ¢

### 9.2 å…³é”®å®ç°ç‚¹
1. **ä¸¥æ ¼éµå¾ªæ¶ˆæ¯æ ¼å¼**: ç¡®ä¿ä¸ç°æœ‰å®¢æˆ·ç«¯å®Œå…¨å…¼å®¹
2. **å®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†**: åŒ…æ‹¬æ‰€æœ‰é”™è¯¯ç±»å‹å’Œé‡è¯•æœºåˆ¶
3. **æ€§èƒ½ä¼˜åŒ–**: ç‰¹åˆ«æ˜¯å¤§æ–‡ä»¶å¤„ç†å’Œå¹¶å‘ç®¡ç†
4. **æµ‹è¯•è¦†ç›–**: ä½¿ç”¨æä¾›çš„æµ‹è¯•å®¢æˆ·ç«¯éªŒè¯å…¼å®¹æ€§

### 9.3 æµ‹è¯•éªŒè¯
é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶:
- `tests/server/test_server_transcription.py`: åŸºç¡€åŠŸèƒ½æµ‹è¯•
- `tests/server/test_concurrent_transcription.py`: å¹¶å‘èƒ½åŠ›æµ‹è¯•

ä½¿ç”¨è¿™äº›æµ‹è¯•ç¡®ä¿æ–°æœåŠ¡å™¨ä¸ç°æœ‰å®¢æˆ·ç«¯å®Œå…¨å…¼å®¹ã€‚

## 10. æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æäº†FunASRéŸ³é¢‘è½¬æ–‡æœ¬æœåŠ¡å™¨çš„å®Œæ•´æŠ€æœ¯è§„èŒƒã€‚æ–°å¼€å‘çš„æœåŠ¡å™¨å¿…é¡»ä¸¥æ ¼éµå¾ªï¼š

1. **åè®®å…¼å®¹**: WebSocketæ¶ˆæ¯æ ¼å¼å’Œäº¤äº’æµç¨‹
2. **åŠŸèƒ½å®Œæ•´**: æ”¯æŒæ‰€æœ‰ç°æœ‰åŠŸèƒ½ç‰¹æ€§
3. **æ€§èƒ½å¯¹ç­‰**: ä¿æŒç›¸åŒçš„å¹¶å‘å¤„ç†èƒ½åŠ›
4. **é”™è¯¯å¤„ç†**: å®ç°å®Œæ•´çš„é”™è¯¯åˆ†ç±»å’Œé‡è¯•æœºåˆ¶

æŒ‰ç…§æœ¬æ–‡æ¡£å¼€å‘çš„æ–°æœåŠ¡å™¨å°†ä¸ç°æœ‰å®¢æˆ·ç«¯å®Œå…¨å…¼å®¹ï¼Œæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç å³å¯å®ç°æ— ç¼è¿ç§»ã€‚